---
name: draft-responses
description: Draft publication-quality "Responses to Reviewers" from manuscript source and reviewer comment files. Produces LaTeX, Markdown, and optional Word output with formal-collegial tone, flagging items needing new analysis.
argument-hint: "v[N]  (e.g., v1, v2) — version number for output files"
allowed-tools: ["Read", "Grep", "Glob", "Write", "Bash", "Task"]
---

# Draft Responses to Reviewers

Produce a complete, publication-quality "Responses to Reviewers" document.

**Input:** `$ARGUMENTS` — version string (e.g., `v1`, `v2`). Defaults to `v1` if omitted.

**Output:**
- `responses/responses_[VERSION].tex` — LaTeX source (primary)
- `responses/responses_[VERSION].md` — Markdown
- `responses/responses_[VERSION].docx` — Word (via pandoc, if available)
- Appended entry in `responses/VERSION_LOG.md`

---

## Steps

### Step 1: Parse version argument
Extract version from `$ARGUMENTS`. If empty, use `v1`.

### Step 2: Locate and index the manuscript
1. Glob `manuscript/` for `.tex`, `.docx`, `.pdf` (prefer `.tex`)
2. Read the manuscript end-to-end
3. Build a **manuscript index**:
   - Sections: number, title, page/line range
   - Equations: number and brief description
   - Tables: number, title, location
   - Figures: number, title, location
   - Appendix sections: letter, title

### Step 3: Parse reviewer comment files
1. Glob `reviewer_comments/` for all files
2. For each file, detect structure:
   - Numbered comments (`1.`, `2.`, etc.)
   - Lettered comments (`a)`, `b)`, etc.)
   - Labeled comments (`Major Comment 1:`, `Minor:`, etc.)
   - Plain prose (segment by paragraph)
3. For each comment, classify severity:
   - **MAJOR** — requests new analysis, substantial revision, or questions identification
   - **MINOR** — clarifications, exposition, notation, presentation
   - **EDITORIAL** — typos, references, formatting
4. Flag comments that require new empirical analysis with `[ANALYSIS NEEDED]`

### Step 4: Draft each response block
For each reviewer comment, produce:

```
\subsection*{Comment [N]}
\begin{refereequote}
[Exact reviewer comment text]
\end{refereequote}

\textbf{Response:} [Acknowledge the point genuinely. Address it directly.
Cite specific manuscript location for every claimed change.]
```

**Tone rules (enforced on every response):**
1. Open by acknowledging the value of the comment (1 sentence, not sycophantic)
2. State what was done, not what you believe
3. Cite specific location: "We have added X to Section Y (p. Z)" or "See Equation (N)"
4. Never use: "We disagree", "The referee misunderstood", "As we already stated"
5. If a change was NOT made, explain why with a substantive argument
6. For [ANALYSIS NEEDED] items: insert `\analysisneeded{[Brief description of required analysis]}`
7. Match formality level of the journal (assume top-field journal unless told otherwise)

### Step 5: Draft the opening letter
Structure:
```
Dear [Editor / Associate Editor / Referees],

Thank you for the careful reading of "[Paper Title]" and the constructive
feedback from the referees. We have revised the manuscript substantially
in response to the comments. The main changes are:

\begin{itemize}
  \item [Change 1 — 1 sentence]
  \item [Change 2 — 1 sentence]
  \item [Change 3 — 1 sentence]
  (3–5 bullets maximum)
\end{itemize}

We respond to each comment in detail below.

Sincerely,
[Authors]
```

### Step 6: Assemble the full document
Order:
1. Opening letter (to Editor)
2. Response to Associate Editor (if `ae_comments.*` exists)
3. Response to Referee 1 (if `reviewer1.*` exists)
4. Response to Referee 2 (if `reviewer2.*` exists)
5. Response to Referee 3+ (if present)
6. Required Robustness Checks section (if any [ANALYSIS NEEDED] items exist)

### Step 7: Write output files

**LaTeX (`responses/responses_[VERSION].tex`):**

Use the `response-letter` template from `templates/response-letter.md` as the preamble.

```latex
% Auto-generated by /draft-responses on [DATE]
% Version: [VERSION]
% DO NOT EDIT DIRECTLY — re-run /draft-responses [VERSION] to regenerate

[Full LaTeX document]
```

**Markdown (`responses/responses_[VERSION].md`):**

```markdown
---
title: "Responses to Reviewers"
date: [DATE]
version: [VERSION]
---

[Full Markdown document]
```

### Step 8: Run pandoc (if available)
```bash
pandoc responses/responses_[VERSION].md -o responses/responses_[VERSION].docx
```
If pandoc is not installed, skip silently and note in the report.

### Step 9: Append to VERSION_LOG.md
Add entry:
```markdown
### [VERSION] — [DATE]
- **Input:** [manuscript filename] + [reviewer files listed]
- **Comments:** [N total — M major, K minor, J editorial]
- **Analysis needed:** [N items flagged with [ANALYSIS NEEDED]]
- **Quality score:** [estimated /100]
- **Status:** DRAFT
```

### Step 10: Report to user
```
## /draft-responses [VERSION] Complete

**Manuscript:** [filename]
**Reviewer files:** [list]
**Comments parsed:** [N total]
  - Major: M
  - Minor: K
  - Editorial: J

**[ANALYSIS NEEDED] items:** N
  [List each with 1-line description]

**Output:**
  - responses/responses_[VERSION].tex ✓
  - responses/responses_[VERSION].md ✓
  - responses/responses_[VERSION].docx [✓ / ✗ pandoc not found]

**Next steps:**
  1. Address [ANALYSIS NEEDED] items
  2. Run: pdflatex responses/responses_[VERSION].tex
  3. Review tone and citations
  4. Quality check against responses/README.md checklist
```

---

## LaTeX Custom Commands

The response document uses these custom commands (defined in preamble):

```latex
% Referee quote block
\newenvironment{refereequote}{%
  \begin{quote}\itshape\color{gray}
}{%
  \end{quote}
}

% Analysis needed placeholder
\newcommand{\analysisneeded}[1]{%
  \textbf{\color{red}[ANALYSIS NEEDED: #1]}
}

% Manuscript location citation
\newcommand{\msloc}[1]{\textit{(#1)}}
```

---

## Principles

- **Formal + collegial** — like a letter to a respected colleague, not a adversary
- **Always cite location** — "Section 3.2, p. 12" not "in the paper"
- **Never defensive** — acknowledge, address, move on
- **Flag honestly** — [ANALYSIS NEEDED] items must be resolved before submission
- **Do not fabricate** — if the manuscript doesn't contain something, say so
